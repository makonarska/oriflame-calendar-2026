<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Oriflame 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #131821;
            --bg-tertiary: #1a1f2e;
            --accent-primary: #00B7BD; /* Oriflame Laguna */
            --accent-hover: #80CDD0; /* Oriflame Aqua */
            --accent-light: rgba(0, 183, 189, 0.15);
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: rgba(255, 255, 255, 0.08);
            --today-color: #FF8072; /* Oriflame Coral */
            --weekend-color: rgba(39, 116, 174, 0.2); /* Oriflame Atlantic subtle */
            --wednesday-color: #9CDABC; /* Oriflame Green */
            --holiday-color: rgba(39, 116, 174, 0.2); /* Same as weekend - Oriflame Atlantic */
            --trading-sunday-color: rgba(207, 87, 138, 0.25); /* Oriflame Pink Berry subtle */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(139, 92, 246, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(156, 218, 188, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            animation: bgShift 20s ease-in-out infinite alternate;
        }

        @keyframes bgShift {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(20px, -20px) scale(1.05); }
        }

        .container {
            max-width: 1920px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            padding: 1.5rem 2rem;
            background: var(--bg-secondary);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-primary), #9CDABC);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header-title {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; font-weight: 700;
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary), var(--wednesday-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(16, 185, 129, 0.2);
            border-radius: 8px;
            font-size: 0.85rem;
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .sync-status.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.3);
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: blink 2s ease-in-out infinite;
        }

        .sync-status.error .sync-indicator {
            background: #ef4444;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .header-right {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            border: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), #9CDABC);
            color: white;
            box-shadow: 0 4px 20px rgba(156, 218, 188, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(156, 218, 188, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--wednesday-color);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .month-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: visible;
        }

        .month-card:hover {
            transform: translateY(-4px);
            border-color: var(--wednesday-color);
            box-shadow: 0 8px 30px rgba(156, 218, 188, 0.2);
        }

        .month-header {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; font-weight: 700;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .weekday {
            text-align: center;
            font-size: 0.7rem;
            color: var(--text-muted);
            font-weight: 600;
            padding: 0.3rem;
            text-transform: uppercase;
        }

        .weekday.campaign-start {
            color: var(--wednesday-color);
            font-weight: 700;
        }

        .days-container {
            position: relative;
            min-height: auto;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
            position: relative;
        }

        .day {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.4rem;
            padding: 0.75rem;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-weight: 600;
            background: transparent;
            min-height: 90px;
        }
        
        .day-number {
            font-size: 1.1rem;
            font-weight: 600;
            line-height: 1;
            flex-shrink: 0;
        }

        .holiday-name {
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.2rem;
            opacity: 0.9;
            line-height: 1.2;
        }

        .day:not(.empty):not(.other-month):hover {
            background: var(--accent-light);
            color: var(--accent-hover);
            transform: scale(1.1);
            z-index: 10;
        }

        .day.empty {
            cursor: default;
        }

        .day.other-month {
            color: var(--text-muted);
            opacity: 0.3;
        }

        .day.weekend {
            background: var(--weekend-color);
        }

        .day.wednesday {
            background: var(--wednesday-color);
            color: #0a0e1a;
            font-weight: 700;
        }

        .day.holiday {
            background: var(--holiday-color);
            color: var(--text-primary);
            font-weight: 700;
        }

        .day.today {
            box-shadow: 0 0 0 3px var(--today-color) inset;
            animation: todayPulse 3s ease-in-out infinite;
            position: relative;
            z-index: 5;
        }

        .day.today::after {
            content: 'üìç';
            position: absolute;
            top: 0.3rem;
            right: 0.3rem;
            font-size: 1rem;
            animation: todayBounce 2s ease-in-out infinite;
        }

        @keyframes todayPulse {
            0%, 100% { 
                box-shadow: 0 0 0 3px var(--today-color) inset;
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 0 5px var(--today-color) inset, 0 0 20px rgba(255, 128, 114, 0.6);
                transform: scale(1.03);
            }
        }

        @keyframes todayBounce {
            0%, 100% { 
                transform: translateY(0) scale(1);
            }
            50% { 
                transform: translateY(-3px) scale(1.1);
            }
        }

        .event-bar {
            position: absolute;
            height: 24px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0 8px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 5;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .event-bar:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 15;
        }

        /* Event chips inside day cells */
        .event-chip {
            width: 100%;
            padding: 0.35rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }

        .event-chip:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .event-chip.important {
            box-shadow: 0 0 0 2px rgba(156, 218, 188, 0.7), 0 1px 3px rgba(0, 0, 0, 0.2);
            animation: importantPulse 2.5s ease-in-out infinite;
        }

        @keyframes importantPulse {
            0%, 100% {
                box-shadow: 0 0 0 2px rgba(156, 218, 188, 0.7), 0 1px 3px rgba(0, 0, 0, 0.2);
            }
            50% {
                box-shadow: 0 0 0 3px rgba(156, 218, 188, 1), 0 0 15px rgba(156, 218, 188, 0.6);
            }
        }

        .day-number {
            font-size: 1.1rem;
            font-weight: 600;
            line-height: 1;
            flex-shrink: 0;
            margin-bottom: 0.2rem;
        }

        .day-events {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            width: 100%;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeInModal 0.3s ease;
        }

        @keyframes fadeInModal {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--border-color);
            position: relative;
            animation: slideUp 0.4s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; font-weight: 700;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--wednesday-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            color: var(--text-primary);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--wednesday-color);
            box-shadow: 0 0 0 3px rgba(156, 218, 188, 0.2);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .color-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .color-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: var(--text-primary);
        }

        .color-option.selected {
            border-color: var(--text-primary);
            box-shadow: 0 0 10px currentColor;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .event-item {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            border-left: 4px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .event-item:hover {
            transform: translateX(4px);
        }

        .event-info {
            flex: 1;
        }

        .event-title {
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .event-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .event-dates {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .event-link-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--accent-light);
            color: var(--accent-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .event-link-btn:hover {
            background: var(--accent-primary);
            color: white;
            transform: translateY(-1px);
        }

        .delete-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .delete-btn:hover {
            background: #ef4444;
            color: white;
        }

        .no-events {
            text-align: center;
            color: var(--text-muted);
            padding: 2rem;
            font-style: italic;
        }

        .config-banner {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            animation: slideDown 0.6s ease-out;
        }

        .config-banner h3 {
            color: #ef4444;
            margin-bottom: 0.5rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; font-weight: 700;
        }

        .config-banner p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .config-banner code {
            background: var(--bg-tertiary);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            color: var(--wednesday-color);
            font-size: 0.85rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .header-title {
                font-size: 1.5rem;
            }

            .month-card {
                min-height: 350px;
            }

            .day {
                min-height: 70px;
                font-size: 0.95rem;
                padding: 0.5rem;
            }

            .days-container {
                min-height: 500px;
            }
        }

        /* Legend styles */
        .legend {
            display: flex;
            gap: 1.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            font-size: 0.8rem;
            align-items: center;
            margin: 1.5rem 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .legend {
                flex-direction: column;
                gap: 0.75rem;
                align-items: flex-start;
            }
        }

        /* Search dropdown styles */
        .search-container {
            position: relative;
            max-width: 500px;
            margin: 1.5rem 0;
        }

        .search-wrapper {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.1rem;
            color: var(--text-muted);
            pointer-events: none;
        }

        .search-input-styled {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .search-input-styled:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .search-dropdown {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            display: none;
        }

        .search-dropdown.active {
            display: block;
        }

        .search-result-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background: var(--accent-light);
        }

        .search-result-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .search-result-info {
            flex: 1;
        }

        .search-result-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .search-result-dates {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .search-no-results {
            padding: 1.5rem;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .search-count {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }

        /* Highlight animation for found events */
        @keyframes highlightPulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 var(--accent-primary);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 0 8px var(--accent-light);
                transform: scale(1.02);
            }
        }

        .event-chip.highlighted {
            animation: highlightPulse 1.5s ease-in-out 2;
            border: 2px solid var(--accent-primary) !important;
        }

        .day.highlighted {
            animation: highlightPulse 1.5s ease-in-out 2;
        }

        /* List view styles */
        .list-view {
            max-width: 900px;
            margin: 0 auto;
        }

        .list-month-group {
            margin-bottom: 2rem;
        }

        .list-month-header {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; font-weight: 700;
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-primary);
        }

        .list-event-item {
            background: var(--bg-secondary);
            border-left: 4px solid;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .list-event-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .list-event-date {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .list-event-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .list-event-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .list-event-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        /* Print-friendly styles for PDF export */
        .pdf-export-container {
            display: none;
            background: white;
            color: black;
            padding: 2rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        }

        .pdf-export-container.active {
            display: block;
        }

        .pdf-header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 3px solid #000;
            padding-bottom: 1rem;
        }

        .pdf-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #000;
            margin-bottom: 0.5rem;
            letter-spacing: 0.05em;
            word-spacing: 0.2em;
        }

        .pdf-subtitle {
            font-size: 1.2rem;
            color: #333;
        }

        .pdf-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #ddd;
            border: 2px solid #000;
            margin-bottom: 2rem;
        }

        .pdf-day-header {
            background: #f0f0f0;
            padding: 0.5rem;
            text-align: center;
            font-weight: 700;
            font-size: 0.9rem;
            border: 1px solid #ccc;
        }

        .pdf-day {
            background: white;
            min-height: 80px;
            padding: 0.5rem;
            border: 1px solid #ccc;
            position: relative;
        }

        .pdf-day.empty {
            background: #fafafa;
        }

        .pdf-day.weekend {
            background: #f5f5f5;
        }

        .pdf-day.wednesday {
            background: #e8f5e9;
            font-weight: 700;
        }

        .pdf-day-number {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .pdf-holiday-name {
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            color: #000;
            margin-top: 0.2rem;
            line-height: 1.2;
        }

        .pdf-event-chip {
            font-size: 0.65rem;
            padding: 0.2rem 0.4rem;
            margin-top: 0.2rem;
            border-radius: 3px;
            border-left: 3px solid;
            background: #f9f9f9;
        }

        .pdf-legend {
            margin-top: 1rem;
            padding: 1rem;
            background: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .pdf-legend-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .pdf-legend-items {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.85rem;
        }

        .export-pdf-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .export-pdf-btn:hover {
            background: var(--accent-light);
            color: var(--accent-primary);
            border-color: var(--accent-primary);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Configuration Banner - will be hidden once configured -->
        <div class="config-banner" id="config-banner" style="display: none;">
            <h3>‚ö†Ô∏è Konfiguracja wymagana</h3>
            <p>
                Aby kalendarz dzia≈Ça≈Ç, musisz skonfigurowaƒá Supabase:<br>
                1. W kodzie HTML znajd≈∫ liniƒô 773-774<br>
                2. ZastƒÖp <code>YOUR_SUPABASE_URL</code> i <code>YOUR_SUPABASE_ANON_KEY</code> swoimi kluczami z Supabase
            </p>
        </div>

        <header>
            <div class="header-left">
                <div class="logo">üìÖ</div>
                <div>
                    <h1 class="header-title">Marketing Oriflame</h1>
                </div>
            </div>
            <div class="header-right">
                <div class="sync-status" id="sync-status">
                    <div class="sync-indicator"></div>
                    <span id="sync-text">≈ÅƒÖczenie...</span>
                </div>
                <button class="btn btn-secondary" onclick="showTodayInfo()">
                    üìç Dzisiaj
                </button>
                <button class="btn btn-primary" onclick="openAddEventModal()">
                    ‚ûï Dodaj Wydarzenie
                </button>
            </div>
        </header>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #9CDABC;"></div>
                <span>≈öroda ‚Äì pierwszy dzie≈Ñ tygodnia Oriflame</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(39, 116, 174, 0.3);"></div>
                <span>Weekendy i dni ustawowo wolne od pracy</span>
            </div>
        </div>

        <!-- Search with Dropdown -->
        <div class="search-container">
            <div class="search-wrapper">
                <span class="search-icon">üîç</span>
                <input 
                    type="text" 
                    id="search-input" 
                    class="search-input-styled"
                    placeholder="Szukaj wydarze≈Ñ... (Ctrl+K)" 
                    autocomplete="off"
                >
                <div class="search-dropdown" id="search-dropdown"></div>
            </div>
        </div>

        <!-- View Toggle -->
        <div style="display: flex; gap: 0.5rem; margin: 1rem 0;">
            <button class="btn btn-primary" id="view-calendar-btn" onclick="switchView('calendar')">
                üìÖ Kalendarz
            </button>
            <button class="btn btn-secondary" id="view-list-btn" onclick="switchView('list')">
                üìã Lista
            </button>
        </div>

        <div class="calendar-grid" id="calendar-grid">
            <div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-secondary);">≈Åadowanie kalendarza...</div>
        </div>

        <div class="list-view" id="list-view" style="display: none;"></div>

        <!-- Hidden PDF export container -->
        <div class="pdf-export-container" id="pdf-export-container"></div>
    </div>

    <div class="modal" id="event-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Dodaj Wydarzenie</h2>
                <button class="close-btn" onclick="closeModal()">‚úï</button>
            </div>
            <form id="event-form" onsubmit="saveEvent(event)">
                <div class="form-group">
                    <label class="form-label">Tytu≈Ç wydarzenia</label>
                    <input type="text" class="form-input" id="event-title" placeholder="np. Kampania Black Friday" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Data rozpoczƒôcia</label>
                    <input type="date" class="form-input" id="event-date-start" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Data zako≈Ñczenia</label>
                    <input type="date" class="form-input" id="event-date-end" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Opis (opcjonalnie)</label>
                    <textarea class="form-textarea" id="event-description" placeholder="Dodaj szczeg√≥≈Çy..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Link 1 (opcjonalnie)</label>
                    <input type="text" class="form-input" id="event-link1-name" placeholder="Nazwa linku (np. Szczeg√≥≈Çy na SP)" style="margin-bottom: 0.5rem;">
                    <input type="url" class="form-input" id="event-link1-url" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Link 2 (opcjonalnie)</label>
                    <input type="text" class="form-input" id="event-link2-name" placeholder="Nazwa linku (np. Brief kampanii)" style="margin-bottom: 0.5rem;">
                    <input type="url" class="form-input" id="event-link2-url" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Kolor</label>
                    <div class="color-picker">
                        <div class="color-option selected" style="background: #FF8072" data-color="#FF8072" title="Oriflame Coral"></div>
                        <div class="color-option" style="background: #C36D6A" data-color="#C36D6A" title="Oriflame Soft Red"></div>
                        <div class="color-option" style="background: #D47D99" data-color="#D47D99" title="Oriflame Pink Blush"></div>
                        <div class="color-option" style="background: #CF578A" data-color="#CF578A" title="Oriflame Pink Berry"></div>
                        <div class="color-option" style="background: #C800A1" data-color="#C800A1" title="Oriflame Magenta"></div>
                        <div class="color-option" style="background: #8988CC3" data-color="#8988CC3" title="Oriflame Lavender"></div>
                        <div class="color-option" style="background: #2774AE" data-color="#2774AE" title="Oriflame Atlantic"></div>
                        <div class="color-option" style="background: #00B7BD" data-color="#00B7BD" title="Oriflame Laguna"></div>
                        <div class="color-option" style="background: #80CDD0" data-color="#80CDD0" title="Oriflame Aqua"></div>
                        <div class="color-option" style="background: #9CDABC" data-color="#9CDABC" title="Oriflame Green"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="event-important" style="width: 18px; height: 18px; cursor: pointer;">
                        <span>‚≠ê Wa≈ºne wydarzenie</span>
                    </label>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zapisz</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="view-events-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="view-modal-title">Wydarzenia</h2>
                <button class="close-btn" onclick="closeViewModal()">‚úï</button>
            </div>
            <div id="events-list"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeViewModal()">Zamknij</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // KONFIGURACJA SUPABASE - WKLEJ SWOJE KLUCZE TUTAJ!
        // ============================================
        const SUPABASE_URL = 'https://yttyiclvkfwfceipxgmi.supabase.co';  // Zamie≈Ñ na sw√≥j URL
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl0dHlpY2x2a2Z3ZmNlaXB4Z21pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NDQ0MzIsImV4cCI6MjA4NTEyMDQzMn0.KQChUy1cXJZwLj2q7Za3Yanqz5-GvpVb4dpTC4EVP44';  // Zamie≈Ñ na sw√≥j klucz
        // ============================================

        let supabaseClient;
        let events = {};
        let selectedColor = '#FF8072'; // Oriflame Coral
        let selectedDate = null;
        let editingEventId = null; // Track which event we're editing
        let isLoading = false;
        let isConfigured = false;

        const monthNames = ['Stycze≈Ñ', 'Luty', 'Marzec', 'Kwiecie≈Ñ', 'Maj', 'Czerwiec', 'Lipiec', 'Sierpie≈Ñ', 'Wrzesie≈Ñ', 'Pa≈∫dziernik', 'Listopad', 'Grudzie≈Ñ'];
        const weekdayNames = ['≈ör', 'Czw', 'Pt', 'Sb', 'Nd', 'Pn', 'Wt'];
        const holidays2026 = ['01-01', '01-06', '04-04', '04-05', '04-06', '05-01', '05-03', '06-04', '08-15', '08-17', '11-01', '11-11', '12-23', '12-24', '12-25', '12-26'];
        
        const tradingSundays2026 = ['03-29', '04-26', '06-28', '08-30', '12-06', '12-13', '12-20'];
        
        // E-commerce events 2026
        const ecommerceEvents2026 = {
            '02-14': 'üíù WALENTYNKI',
            '03-08': 'üíê DZIE≈É KOBIET',
            '05-26': 'üå∏ DZIE≈É MATKI',
            '06-01': 'üéà DZIE≈É DZIECKA',
            '06-23': 'üëî DZIE≈É OJCA',
            '09-01': 'üéí POWR√ìT DO SZKO≈ÅY',
            '10-31': 'üéÉ HALLOWEEN',
            '11-27': 'üõí BLACK FRIDAY',
            '11-29': 'üîÆ ANDRZEJKI',
            '11-30': 'üíª CYBER MONDAY',
            '12-06': 'üéÖ MIKO≈ÅAJKI'
        };
        
        const holidayNames = {
            '01-01': 'NOWY ROK',
            '01-06': 'TRZECH KR√ìLI',
            '04-04': 'WIELKA SOBOTA',
            '04-05': 'WIELKANOC',
            '04-06': 'PONIEDZIA≈ÅEK WIELKANOCNY',
            '05-01': '≈öWIƒòTO PRACY',
            '05-03': '≈öWIƒòTO KONSTYTUCJI 3 MAJA',
            '06-04': 'BO≈ªE CIA≈ÅO',
            '08-15': 'WNIEBOWZIƒòCIE NMP',
            '08-17': 'ODBI√ìR ZA SOBOTƒò',
            '11-01': 'WSZYSTKICH ≈öWIƒòTYCH',
            '11-11': '≈öWIƒòTO NIEPODLEG≈ÅO≈öCI',
            '12-23': 'ODBI√ìR ZA SOBOTƒò',
            '12-24': 'WIGILIA',
            '12-25': 'BO≈ªE NARODZENIE',
            '12-26': 'DRUGI DZIE≈É ≈öWIƒÑT'
        };
        
        function getHolidayName(year, month, day) {
            const dateStr = `${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            
            // Check if it's a trading Sunday
            if (tradingSundays2026.includes(dateStr)) {
                return 'NIEDZIELA HANDLOWA üõçÔ∏è';
            }
            
            // Check for e-commerce events
            if (ecommerceEvents2026[dateStr]) {
                return ecommerceEvents2026[dateStr];
            }
            
            return holidayNames[dateStr] || null;
        }
        
        function isTradingSunday(year, month, day) {
            const dateStr = `${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            return tradingSundays2026.includes(dateStr);
        }

        // Initialize Supabase
        function initSupabase() {
            if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY') {
                document.getElementById('config-banner').style.display = 'block';
                updateSyncStatus('Nie skonfigurowano', true);
                isConfigured = false;
                return false;
            }

            try {
                // Check multiple possible locations for Supabase
                const SupabaseLib = window.supabase || window.Supabase || (window.supabase && window.supabase.supabase);
                
                if (!SupabaseLib || !SupabaseLib.createClient) {
                    console.error('Supabase library not loaded. Available:', Object.keys(window).filter(k => k.toLowerCase().includes('supabase')));
                    updateSyncStatus('Biblioteka nie za≈Çadowana', true);
                    isConfigured = false;
                    return false;
                }
                
                supabaseClient = SupabaseLib.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                isConfigured = true;
                updateSyncStatus('Po≈ÇƒÖczono');
                
                // Subscribe to realtime changes
                // supabaseClient
                //     .channel('events-changes')
                //     .on('postgres_changes', { event: '*', schema: 'public', table: 'events' }, () => {
                //         loadEvents();
                //     })
                //     .subscribe();
                
                return true;
            } catch (error) {
                console.error('Supabase initialization error:', error);
                updateSyncStatus('B≈ÇƒÖd po≈ÇƒÖczenia', true);
                isConfigured = false;
                return false;
            }
        }

        function updateSyncStatus(text, isError = false) {
            const status = document.getElementById('sync-status');
            const statusText = document.getElementById('sync-text');
            statusText.textContent = text;
            
            if (isError) {
                status.classList.add('error');
            } else {
                status.classList.remove('error');
            }
        }

        function getDaysInMonth(year, month) {
            return new Date(year, month + 1, 0).getDate();
        }

        function getFirstDayOfMonth(year, month) {
            const date = new Date(year, month, 1);
            let day = date.getDay();
            day = (day + 4) % 7;
            return day;
        }

        function formatDate(year, month, day) {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        function parseDate(dateStr) {
            const parts = dateStr.split('-');
            return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
        }

        function isToday(year, month, day) {
            const today = new Date();
            return today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
        }

        function isWednesday(year, month, day) {
            return new Date(year, month, day).getDay() === 3;
        }

        function isWeekend(year, month, day) {
            const dayOfWeek = new Date(year, month, day).getDay();
            return dayOfWeek === 0 || dayOfWeek === 6;
        }

        function isHoliday(year, month, day) {
            const dateStr = `${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            return holidays2026.includes(dateStr);
        }

        async function loadEvents() {
            if (!isConfigured) {
                events = {};
                await generateCalendar();
                return;
            }

            if (isLoading) return;
            isLoading = true;

            try {
                console.log('Loading events from Supabase...');
                console.log('Client:', supabaseClient);
                console.log('URL:', SUPABASE_URL);
                
                const { data, error } = await supabaseClient
                    .from('events')
                    .select('*');

                console.log('Response:', { data, error });

                if (error) {
                    console.error('Supabase error details:', error);
                    throw error;
                }

                events = {};
                if (data) {
                    data.forEach(row => {
                        events[row.event_id] = row.event_data;
                    });
                }

                await generateCalendar();
                updateSyncStatus('Zsynchronizowano');
            } catch (error) {
                console.error('Error loading events:', error);
                console.error('Error details:', {
                    message: error.message,
                    stack: error.stack,
                    supabaseClient: !!supabaseClient
                });
                updateSyncStatus('B≈ÇƒÖd wczytywania', true);
            } finally {
                isLoading = false;
            }
        }

        async function saveEventToStorage(eventId, eventData) {
            if (!isConfigured) {
                alert('Supabase nie jest skonfigurowane. Zobacz instrukcje w g√≥rnej czƒô≈õci strony.');
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('events')
                    .upsert({
                        event_id: eventId,
                        event_data: eventData,
                        updated_at: new Date().toISOString()
                    });

                if (error) throw error;
                updateSyncStatus('Zapisano');
            } catch (error) {
                console.error('Error saving event:', error);
                updateSyncStatus('B≈ÇƒÖd zapisu', true);
                throw error;
            }
        }

        async function deleteEventFromStorage(eventId) {
            if (!isConfigured) return;

            try {
                const { error } = await supabaseClient
                    .from('events')
                    .delete()
                    .eq('event_id', eventId);

                if (error) throw error;
                updateSyncStatus('Usuniƒôto');
            } catch (error) {
                console.error('Error deleting event:', error);
                updateSyncStatus('B≈ÇƒÖd usuwania', true);
            }
        }

        function getEventsForMonth(year, month) {
            const monthEvents = [];
            const monthStart = new Date(year, month, 1);
            const monthEnd = new Date(year, month + 1, 0);

            for (const [eventId, event] of Object.entries(events)) {
                const eventStart = parseDate(event.startDate);
                const eventEnd = parseDate(event.endDate);
                if (eventEnd >= monthStart && eventStart <= monthEnd) {
                    monthEvents.push({ id: eventId, ...event });
                }
            }
            return monthEvents;
        }

        function calculateEventPosition(event, year, month, firstDay, daysInMonth) {
            const eventStart = parseDate(event.startDate);
            const eventEnd = parseDate(event.endDate);
            const monthStart = new Date(year, month, 1);
            const monthEnd = new Date(year, month + 1, 0);

            let startDay;
            if (eventStart < monthStart) {
                startDay = 1;
            } else if (eventStart.getMonth() === month && eventStart.getFullYear() === year) {
                startDay = eventStart.getDate();
            } else {
                return null;
            }

            let endDay;
            if (eventEnd > monthEnd) {
                endDay = daysInMonth;
            } else if (eventEnd.getMonth() === month && eventEnd.getFullYear() === year) {
                endDay = eventEnd.getDate();
            } else {
                return null;
            }

            const startCol = (firstDay + startDay - 1) % 7;
            const startRow = Math.floor((firstDay + startDay - 1) / 7);
            const endCol = (firstDay + endDay - 1) % 7;
            const endRow = Math.floor((firstDay + endDay - 1) / 7);

            return { startDay, endDay, startCol, startRow, endCol, endRow };
        }

        async function generateCalendar() {
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';

            for (let month = 0; month < 12; month++) {
                const monthCard = createMonthCard(2026, month);
                grid.appendChild(monthCard);
            }
        }

        function createMonthCard(year, month) {
            const card = document.createElement('div');
            card.className = 'month-card';
            card.style.animationDelay = `${month * 0.05}s`;

            const header = document.createElement('div');
            header.className = 'month-header';
            header.style.display = 'flex';
            header.style.justifyContent = 'space-between';
            header.style.alignItems = 'center';
            
            const monthTitle = document.createElement('span');
            monthTitle.textContent = monthNames[month];
            
            const exportBtn = document.createElement('button');
            exportBtn.className = 'export-pdf-btn';
            exportBtn.textContent = 'üìÑ PDF';
            exportBtn.dataset.year = year;
            exportBtn.dataset.month = month;
            
            // Add event listener properly
            exportBtn.addEventListener('click', () => exportMonthToPDF(year, month));
            
            header.appendChild(monthTitle);
            header.appendChild(exportBtn);

            const weekdays = document.createElement('div');
            weekdays.className = 'weekdays';
            weekdayNames.forEach((day, index) => {
                const weekday = document.createElement('div');
                weekday.className = 'weekday';
                if (index === 0) weekday.classList.add('campaign-start');
                weekday.textContent = day;
                weekdays.appendChild(weekday);
            });

            const daysContainer = document.createElement('div');
            daysContainer.className = 'days-container';

            const days = document.createElement('div');
            days.className = 'days';

            const firstDay = getFirstDayOfMonth(year, month);
            const daysInMonth = getDaysInMonth(year, month);
            const prevMonthDays = month === 0 ? getDaysInMonth(year - 1, 11) : getDaysInMonth(year, month - 1);

            // Get events for this month
            const monthEvents = getEventsForMonth(year, month);
            
            // Group events by day
            const eventsByDay = {};
            monthEvents.forEach(event => {
                const eventStart = parseDate(event.startDate);
                const eventEnd = parseDate(event.endDate);
                const monthStart = new Date(year, month, 1);
                const monthEnd = new Date(year, month + 1, 0);

                for (let d = 1; d <= daysInMonth; d++) {
                    const currentDay = new Date(year, month, d);
                    if (currentDay >= eventStart && currentDay <= eventEnd) {
                        const dateKey = formatDate(year, month, d);
                        if (!eventsByDay[dateKey]) {
                            eventsByDay[dateKey] = [];
                        }
                        eventsByDay[dateKey].push(event);
                    }
                }
            });

            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'day other-month';
                day.textContent = prevMonthDays - i;
                days.appendChild(day);
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'day';
                
                // Day number
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayElement.appendChild(dayNumber);

                // Add holiday name if applicable
                const holidayName = getHolidayName(year, month, day);
                if (holidayName) {
                    const holidayLabel = document.createElement('div');
                    holidayLabel.className = 'holiday-name';
                    holidayLabel.textContent = holidayName;
                    dayElement.appendChild(holidayLabel);
                }

                // Day classes
                if (isToday(year, month, day)) dayElement.classList.add('today');
                if (isWednesday(year, month, day)) dayElement.classList.add('wednesday');
                if (isHoliday(year, month, day)) dayElement.classList.add('holiday');
                if (isWeekend(year, month, day) && !isWednesday(year, month, day) && !isHoliday(year, month, day)) {
                    dayElement.classList.add('weekend');
                }

                const dateKey = formatDate(year, month, day);
                dayElement.onclick = () => handleDayClick(dateKey);

                // Add events for this day
                if (eventsByDay[dateKey] && eventsByDay[dateKey].length > 0) {
                    const eventsContainer = document.createElement('div');
                    eventsContainer.className = 'day-events';
                    
                    eventsByDay[dateKey].forEach(event => {
                        const eventChip = document.createElement('div');
                        eventChip.className = 'event-chip';
                        if (event.important) {
                            eventChip.classList.add('important');
                        }
                        eventChip.style.background = event.color;
                        eventChip.textContent = event.title;
                        
                        // Determine opacity based on position in multi-day event
                        const eventStart = parseDate(event.startDate);
                        const eventEnd = parseDate(event.endDate);
                        const currentDate = new Date(year, month, day);
                        
                        const isFirstDay = currentDate.getTime() === eventStart.getTime();
                        const isLastDay = currentDate.getTime() === eventEnd.getTime();
                        
                        if (isFirstDay && isLastDay) {
                            // Single day event - full opacity
                            eventChip.style.opacity = '1';
                            eventChip.style.fontSize = '0.75rem';
                        } else if (isFirstDay) {
                            // First day - full opacity
                            eventChip.style.opacity = '1';
                            eventChip.style.fontSize = '0.75rem';
                        } else if (isLastDay) {
                            // Last day - medium opacity
                            eventChip.style.opacity = '0.65';
                            eventChip.style.fontSize = '0.65rem';
                        } else {
                            // Middle days - subtle
                            eventChip.style.opacity = '0.5';
                            eventChip.style.fontSize = '0.65rem';
                        }
                        
                        eventChip.onclick = (e) => {
                            e.stopPropagation();
                            viewEvent(event.id);
                        };
                        eventsContainer.appendChild(eventChip);
                    });
                    
                    dayElement.appendChild(eventsContainer);
                }
                
                days.appendChild(dayElement);
            }

            // Next month days
            const totalCells = firstDay + daysInMonth;
            const remainingCells = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7);
            for (let day = 1; day <= remainingCells; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'day other-month';
                dayElement.textContent = day;
                days.appendChild(dayElement);
            }

            daysContainer.appendChild(days);
            card.appendChild(header);
            card.appendChild(weekdays);
            card.appendChild(daysContainer);

            return card;
        }

        function handleDayClick(dateKey) {
            selectedDate = dateKey;
            document.getElementById('event-date-start').value = dateKey;
            document.getElementById('event-date-end').value = dateKey;
            openModal();
        }

        function viewEvent(eventId) {
            const event = events[eventId];
            if (!event) return;

            const modal = document.getElementById('view-events-modal');
            const title = document.getElementById('view-modal-title');
            const list = document.getElementById('events-list');

            title.textContent = 'Szczeg√≥≈Çy wydarzenia';
            list.innerHTML = '';

            const item = document.createElement('div');
            item.className = 'event-item';
            item.style.borderColor = event.color;

            const startDate = parseDate(event.startDate);
            const endDate = parseDate(event.endDate);
            const dateRange = `${startDate.getDate()} ${monthNames[startDate.getMonth()]} - ${endDate.getDate()} ${monthNames[endDate.getMonth()]}`;

            item.innerHTML = `
                <div class="event-info">
                    <div class="event-title" style="color: ${event.color}">${event.title}</div>
                    <div class="event-dates">${dateRange}</div>
                    ${event.description ? `<div class="event-description">${event.description}</div>` : ''}
                    ${renderLinks(event)}
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-secondary edit-event-btn" style="padding: 0.5rem 1rem;" data-event-id="${eventId}">‚úèÔ∏è Edytuj</button>
                    <button class="delete-btn delete-event-btn" data-event-id="${eventId}">Usu≈Ñ</button>
                </div>
            `;
            
            // Add event listeners after creating HTML
            const editBtn = item.querySelector('.edit-event-btn');
            const deleteBtn = item.querySelector('.delete-event-btn');
            
            editBtn.addEventListener('click', () => editEvent(eventId));
            deleteBtn.addEventListener('click', () => deleteEvent(eventId));
            
            list.appendChild(item);

            modal.classList.add('active');
        }

        function openModal() {
            document.getElementById('event-modal').classList.add('active');
        }

        function openAddEventModal() {
            const today = new Date();
            const dateString = formatDate(today.getFullYear(), today.getMonth(), today.getDate());
            document.getElementById('event-date-start').value = dateString;
            document.getElementById('event-date-end').value = dateString;
            selectedDate = dateString;
            openModal();
        }

        function closeModal() {
            document.getElementById('event-modal').classList.remove('active');
            document.getElementById('event-form').reset();
            selectedColor = '#FF8072';
            editingEventId = null;
            updateColorSelection();
            document.querySelector('.modal-title').textContent = 'Dodaj Wydarzenie';
            document.querySelector('#event-form button[type="submit"]').textContent = 'üíæ Zapisz Wydarzenie';
        }

        function editEvent(eventId) {
            const event = events[eventId];
            if (!event) return;

            editingEventId = eventId;
            
            // Fill form with event data
            document.getElementById('event-title').value = event.title;
            document.getElementById('event-description').value = event.description || '';
            
            // Load links
            const links = event.links || [];
            document.getElementById('event-link1-name').value = links[0]?.name || '';
            document.getElementById('event-link1-url').value = links[0]?.url || '';
            document.getElementById('event-link2-name').value = links[1]?.name || '';
            document.getElementById('event-link2-url').value = links[1]?.url || '';
            
            // Load important checkbox
            document.getElementById('event-important').checked = event.important || false;
            
            document.getElementById('event-date-start').value = event.startDate;
            document.getElementById('event-date-end').value = event.endDate;
            selectedColor = event.color;
            updateColorSelection();

            // Change modal title and button
            document.querySelector('.modal-title').textContent = 'Edytuj Wydarzenie';
            document.querySelector('#event-form button[type="submit"]').textContent = 'üíæ Zapisz Zmiany';

            // Close view modal and open edit modal
            closeViewModal();
            openModal();
        }

        function closeViewModal() {
            document.getElementById('view-events-modal').classList.remove('active');
        }

        function renderLinks(event) {
            if (!event.links || event.links.length === 0) return '';
            
            return event.links.map(link => 
                `<a href="${link.url}" target="_blank" class="event-link-btn" onclick="event.stopPropagation()">üîó ${link.name}</a>`
            ).join(' ');
        }

        async function saveEvent(e) {
            e.preventDefault();

            const title = document.getElementById('event-title').value;
            const startDate = document.getElementById('event-date-start').value;
            const endDate = document.getElementById('event-date-end').value;
            const description = document.getElementById('event-description').value;
            
            // Get links with names
            const link1Name = document.getElementById('event-link1-name').value;
            const link1Url = document.getElementById('event-link1-url').value;
            const link2Name = document.getElementById('event-link2-name').value;
            const link2Url = document.getElementById('event-link2-url').value;
            
            const links = [];
            if (link1Url) links.push({ name: link1Name || 'Link 1', url: link1Url });
            if (link2Url) links.push({ name: link2Name || 'Link 2', url: link2Url });
            
            const important = document.getElementById('event-important').checked;

            if (new Date(endDate) < new Date(startDate)) {
                alert('Data zako≈Ñczenia nie mo≈ºe byƒá wcze≈õniejsza ni≈º data rozpoczƒôcia!');
                return;
            }

            const event = { title, description, links, important, color: selectedColor, startDate, endDate };

            if (editingEventId) {
                // Update existing event
                events[editingEventId] = event;
                try {
                    await saveEventToStorage(editingEventId, event);
                    closeModal();
                    await generateCalendar();
                } catch (error) {
                    alert('B≈ÇƒÖd podczas aktualizowania wydarzenia. Spr√≥buj ponownie.');
                    console.error('Update error:', error);
                }
            } else {
                // Create new event
                const eventId = 'evt_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                events[eventId] = event;

                try {
                    await saveEventToStorage(eventId, event);
                    closeModal();
                    await generateCalendar();
                } catch (error) {
                    alert('B≈ÇƒÖd podczas zapisywania wydarzenia. Spr√≥buj ponownie.');
                    console.error('Save error:', error);
                }
            }
        }

        async function deleteEvent(eventId) {
            if (!confirm('Czy na pewno chcesz usunƒÖƒá to wydarzenie?')) return;

            delete events[eventId];
            await deleteEventFromStorage(eventId);
            closeViewModal();
            await generateCalendar();
        }

        function showTodayInfo() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Scroll to today's date first
            const todayElement = document.querySelector('.day.today');
            if (todayElement) {
                todayElement.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
                
                // Add extra highlight animation
                todayElement.style.animation = 'none';
                setTimeout(() => {
                    todayElement.style.animation = '';
                }, 10);
            }
            
            // Wait for scroll to finish, then show modal
            setTimeout(() => {
                const todayEvents = Object.entries(events).filter(([id, event]) => {
                    const start = parseDate(event.startDate);
                    const end = parseDate(event.endDate);
                    return start <= today && end >= today;
                });

                if (todayEvents.length > 0) {
                    const modal = document.getElementById('view-events-modal');
                    const title = document.getElementById('view-modal-title');
                    const list = document.getElementById('events-list');

                    title.textContent = `Wydarzenia na dzisiaj - ${today.getDate()} ${monthNames[today.getMonth()]}`;
                    list.innerHTML = '';

                    todayEvents.forEach(([eventId, event]) => {
                        const item = document.createElement('div');
                        item.className = 'event-item';
                        item.style.borderColor = event.color;

                        const startDate = parseDate(event.startDate);
                        const endDate = parseDate(event.endDate);
                        const dateRange = `${startDate.getDate()} ${monthNames[startDate.getMonth()]} - ${endDate.getDate()} ${monthNames[endDate.getMonth()]}`;

                        item.innerHTML = `
                            <div class="event-info">
                                <div class="event-title" style="color: ${event.color}">${event.title}</div>
                                <div class="event-dates">${dateRange}</div>
                                ${event.description ? `<div class="event-description">${event.description}</div>` : ''}
                                ${renderLinks(event)}
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary edit-event-btn" style="padding: 0.5rem 1rem;" data-event-id="${eventId}">‚úèÔ∏è Edytuj</button>
                                <button class="delete-btn delete-event-btn" data-event-id="${eventId}">Usu≈Ñ</button>
                            </div>
                        `;
                        
                        // Add event listeners after creating HTML
                        const editBtn = item.querySelector('.edit-event-btn');
                        const deleteBtn = item.querySelector('.delete-event-btn');
                        
                        editBtn.addEventListener('click', () => editEvent(eventId));
                        deleteBtn.addEventListener('click', () => deleteEvent(eventId));
                        
                        list.appendChild(item);
                    });

                    modal.classList.add('active');
                } else {
                    alert('Brak wydarze≈Ñ na dzisiaj!');
                }
            }, 800); // Wait 800ms for smooth scroll to finish
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const colorOptions = document.querySelectorAll('.color-option');
            colorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    colorOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    selectedColor = option.dataset.color;
                });
            });

            // Search functionality
            const searchInput = document.getElementById('search-input');
            const searchDropdown = document.getElementById('search-dropdown');

            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                
                if (!query) {
                    searchDropdown.classList.remove('active');
                    return;
                }

                const results = [];
                for (const [eventId, event] of Object.entries(events)) {
                    if (event.title.toLowerCase().includes(query)) {
                        results.push({ id: eventId, ...event });
                    }
                }

                displaySearchResults(results, query);
            });

            // Ctrl+K shortcut
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
                // Esc to close dropdown
                if (e.key === 'Escape') {
                    searchDropdown.classList.remove('active');
                    searchInput.blur();
                }
            });

            // Click outside to close dropdown
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) {
                    searchDropdown.classList.remove('active');
                }
            });

            initSupabase();
            await loadEvents();
        });

        function displaySearchResults(results, query) {
            const dropdown = document.getElementById('search-dropdown');
            
            if (results.length === 0) {
                dropdown.innerHTML = `
                    <div class="search-no-results">
                        Nie znaleziono wydarze≈Ñ dla: "${query}"
                    </div>
                `;
                dropdown.classList.add('active');
                return;
            }

            let html = `<div class="search-count">Znaleziono: ${results.length} ${results.length === 1 ? 'wydarzenie' : 'wydarze≈Ñ'}</div>`;
            
            results.forEach(event => {
                const startDate = parseDate(event.startDate);
                const endDate = parseDate(event.endDate);
                const dateRange = `${startDate.getDate()} ${monthNames[startDate.getMonth()]} - ${endDate.getDate()} ${monthNames[endDate.getMonth()]}`;
                
                html += `
                    <div class="search-result-item" onclick="scrollToEvent('${event.id}')">
                        <div class="search-result-color" style="background: ${event.color};"></div>
                        <div class="search-result-info">
                            <div class="search-result-title">${event.title}</div>
                            <div class="search-result-dates">${dateRange}</div>
                        </div>
                    </div>
                `;
            });

            dropdown.innerHTML = html;
            dropdown.classList.add('active');
        }

        function scrollToEvent(eventId) {
            const event = events[eventId];
            if (!event) return;

            // Close dropdown
            document.getElementById('search-dropdown').classList.remove('active');
            document.getElementById('search-input').value = '';

            // Find all chips for this event
            const allChips = document.querySelectorAll('.event-chip');
            let targetChip = null;
            
            allChips.forEach(chip => {
                // Check if this chip belongs to our event by comparing title and color
                if (chip.textContent.includes(event.title) && 
                    (chip.style.background.includes(event.color.toLowerCase()) || 
                     chip.style.backgroundColor.includes(event.color.toLowerCase()))) {
                    if (!targetChip) targetChip = chip;
                }
            });

            if (targetChip) {
                // Remove previous highlights
                document.querySelectorAll('.highlighted').forEach(el => {
                    el.classList.remove('highlighted');
                });

                // Scroll to and highlight
                targetChip.scrollIntoView({ behavior: 'smooth', block: 'center' });
                targetChip.classList.add('highlighted');
                
                // Also highlight the parent day
                const parentDay = targetChip.closest('.day');
                if (parentDay) {
                    parentDay.classList.add('highlighted');
                }

                // Remove highlight after animation
                setTimeout(() => {
                    targetChip.classList.remove('highlighted');
                    if (parentDay) parentDay.classList.remove('highlighted');
                }, 3000);
            }
        }

        let currentView = 'calendar';

        function switchView(view) {
            currentView = view;
            const calendarGrid = document.getElementById('calendar-grid');
            const listView = document.getElementById('list-view');
            const calendarBtn = document.getElementById('view-calendar-btn');
            const listBtn = document.getElementById('view-list-btn');

            if (view === 'calendar') {
                calendarGrid.style.display = 'grid';
                listView.style.display = 'none';
                calendarBtn.className = 'btn btn-primary';
                listBtn.className = 'btn btn-secondary';
            } else {
                calendarGrid.style.display = 'none';
                listView.style.display = 'block';
                calendarBtn.className = 'btn btn-secondary';
                listBtn.className = 'btn btn-primary';
                generateListView();
            }
        }

        function generateListView() {
            const listContainer = document.getElementById('list-view');
            
            // Group events by month
            const eventsByMonth = {};
            
            for (const [eventId, event] of Object.entries(events)) {
                const startDate = parseDate(event.startDate);
                const monthKey = `${startDate.getFullYear()}-${startDate.getMonth()}`;
                
                if (!eventsByMonth[monthKey]) {
                    eventsByMonth[monthKey] = [];
                }
                
                eventsByMonth[monthKey].push({ id: eventId, ...event });
            }

            // Sort months
            const sortedMonths = Object.keys(eventsByMonth).sort();

            let html = '';
            
            sortedMonths.forEach(monthKey => {
                const [year, monthIndex] = monthKey.split('-').map(Number);
                const monthName = monthNames[monthIndex].toUpperCase();
                
                // Sort events by start date
                const monthEvents = eventsByMonth[monthKey].sort((a, b) => {
                    return parseDate(a.startDate) - parseDate(b.startDate);
                });

                html += `<div class="list-month-group">`;
                html += `<h2 class="list-month-header">${monthName} ${year}</h2>`;

                monthEvents.forEach(event => {
                    const startDate = parseDate(event.startDate);
                    const endDate = parseDate(event.endDate);
                    
                    let dateDisplay;
                    if (event.startDate === event.endDate) {
                        dateDisplay = `${startDate.getDate()} ${monthNames[startDate.getMonth()]}`;
                    } else {
                        dateDisplay = `${startDate.getDate()} ${monthNames[startDate.getMonth()]} - ${endDate.getDate()} ${monthNames[endDate.getMonth()]}`;
                    }

                    html += `
                        <div class="list-event-item" style="border-color: ${event.color};">
                            <div class="list-event-date">${dateDisplay}</div>
                            <div class="list-event-title" style="color: ${event.color};">${event.title}</div>
                            ${event.description ? `<div class="list-event-description">${event.description}</div>` : ''}
                            ${renderLinks(event)}
                            <div class="list-event-actions">
                                <button class="btn btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;" onclick="editEventFromList('${event.id}')">‚úèÔ∏è Edytuj</button>
                                <button class="delete-btn" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;" onclick="deleteEvent('${event.id}')">Usu≈Ñ</button>
                            </div>
                        </div>
                    `;
                });

                html += `</div>`;
            });

            if (html === '') {
                html = '<div style="text-align: center; padding: 3rem; color: var(--text-muted);">Brak wydarze≈Ñ</div>';
            }

            listContainer.innerHTML = html;
        }

        function editEventFromList(eventId) {
            editEvent(eventId);
        }

        async function exportMonthToPDF(year, month) {
            const container = document.getElementById('pdf-export-container');
            
            // Build eventsByDay for this month
            const eventsByDay = {};
            for (const [eventId, event] of Object.entries(events)) {
                const startDate = parseDate(event.startDate);
                const endDate = parseDate(event.endDate);
                
                let currentDate = new Date(startDate);
                while (currentDate <= endDate) {
                    const dateKey = formatDate(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate());
                    
                    // Only add if it's in the target month
                    if (currentDate.getMonth() === month && currentDate.getFullYear() === year) {
                        if (!eventsByDay[dateKey]) {
                            eventsByDay[dateKey] = [];
                        }
                        eventsByDay[dateKey].push(event);
                    }
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
            }
            
            // Generate print-friendly HTML
            let html = `
                <div class="pdf-header">
                    <div class="pdf-title">MARKETING ORIFLAME</div>
                    <div class="pdf-subtitle">${monthNames[month].toUpperCase()} ${year}</div>
                </div>
                
                <div class="pdf-calendar-grid">
            `;
            
            // Weekday headers
            weekdayNames.forEach((day) => {
                html += `<div class="pdf-day-header">${day}</div>`;
            });
            
            // Empty days before month starts
            const firstDay = getFirstDayOfMonth(year, month);
            for (let i = 0; i < firstDay; i++) {
                html += `<div class="pdf-day empty"></div>`;
            }
            
            // Days of month
            const daysInMonth = getDaysInMonth(year, month);
            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = formatDate(year, month, day);
                const isWed = isWednesday(year, month, day);
                const isWknd = isWeekend(year, month, day);
                const holidayName = getHolidayName(year, month, day);
                
                let dayClass = 'pdf-day';
                if (isWed) dayClass += ' wednesday';
                else if (isWknd) dayClass += ' weekend';
                
                html += `<div class="${dayClass}">`;
                html += `<div class="pdf-day-number">${day}</div>`;
                
                if (holidayName) {
                    html += `<div class="pdf-holiday-name">${holidayName}</div>`;
                }
                
                // Add events for this day
                if (eventsByDay[dateKey]) {
                    eventsByDay[dateKey].forEach(event => {
                        html += `<div class="pdf-event-chip" style="border-color: ${event.color};">${event.title}</div>`;
                    });
                }
                
                html += `</div>`;
            }
            
            html += `</div>`; // Close grid
            
            // Legend
            html += `
                <div class="pdf-legend">
                    <div class="pdf-legend-title">Legenda:</div>
                    <div class="pdf-legend-items">
                        <span>üü¢ ≈öroda ‚Äì pierwszy dzie≈Ñ tygodnia Oriflame</span>
                        <span>‚¨ú Weekendy i dni wolne od pracy</span>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            container.classList.add('active');
            
            // Wait for rendering
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Generate PDF
            try {
                const canvas = await html2canvas(container, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    logging: false
                });
                
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgWidth = 210; // A4 width in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, imgWidth, imgHeight);
                pdf.save(`Oriflame_Kalendarz_${monthNames[month]}_${year}.pdf`);
                
            } catch (error) {
                console.error('PDF generation error:', error);
                alert('B≈ÇƒÖd podczas generowania PDF');
            }
            
            // Clean up
            container.classList.remove('active');
            container.innerHTML = '';
        }

        function updateColorSelection() {
            const colorOptions = document.querySelectorAll('.color-option');
            colorOptions.forEach(option => {
                if (option.dataset.color === selectedColor) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        document.getElementById('event-modal').addEventListener('click', (e) => {
            if (e.target.id === 'event-modal') closeModal();
        });

        document.getElementById('view-events-modal').addEventListener('click', (e) => {
            if (e.target.id === 'view-events-modal') closeViewModal();
        });
    </script>
</body>
</html>
